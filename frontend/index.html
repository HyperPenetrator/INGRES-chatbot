<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGRES Groundwater Chatbot</title>
    <!-- Include Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A little bit of custom CSS for the chat bubbles and scrollbar */
        .chat-bubble-user {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
        .chat-bubble-bot {
            background-color: #E5E7EB; /* gray-200 */
            color: #1F2937; /* gray-800 */
        }
        /* Custom scrollbar for a cleaner look */
        #chatbox::-webkit-scrollbar {
            width: 8px;
        }
        #chatbox::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        #chatbox::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        #chatbox::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Custom styles for the data table */
        .data-table th, .data-table td {
            padding: 6px 10px;
            text-align: left;
            font-size: 0.8rem;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans flex flex-col h-screen">

    <!-- Header Section -->
    <header class="bg-white shadow-md w-full p-4">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-2xl font-bold text-gray-800">INGRES Groundwater Chatbot</h1>
            <p class="text-sm text-gray-500">Your AI assistant for groundwater data analysis</p>
        </div>
    </header>

    <!-- Main Chat Area -->
    <main class="flex-1 flex flex-col items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl h-full flex flex-col rounded-lg shadow-lg">
            
            <!-- Chat Messages Display -->
            <div id="chatbox" class="flex-1 p-6 overflow-y-auto">
                <div class="flex justify-start mb-4">
                    <div class="chat-bubble-bot py-2 px-4 rounded-lg max-w-2xl">
                        <p class="font-bold mb-1">INGRES Bot</p>
                        <p>Hello! How can I assist you today? Please ask me about groundwater data for "Andhra Pradesh" or "Maharashtra".</p>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="px-6 pb-2 text-sm text-gray-400 hidden">
                <p>Bot is typing...</p>
            </div>

            <!-- Message Input Section -->
            <div class="border-t p-4 bg-gray-50 rounded-b-lg">
                <div class="flex items-center space-x-3">
                    <input type="text" id="userInput" class="flex-1 border rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ask about groundwater...">
                    <button onclick="sendMessage()" class="bg-blue-500 text-white rounded-full p-2 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const userInput = document.getElementById('userInput');
        const chatbox = document.getElementById('chatbox');
        const typingIndicator = document.getElementById('typing-indicator');

        function scrollToBottom() {
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') sendMessage();
        });

        async function sendMessage() {
            const message = userInput.value;
            if (!message.trim()) return;

            appendMessage('You', message, 'user');
            userInput.value = '';
            typingIndicator.classList.remove('hidden');
            scrollToBottom();

            try {
                    const response = await fetch('[https://ingres-chatbot-h4uj.onrender.com/](https://ingres-chatbot-h4uj.onrender.com/)', { 
    // ... rest of the code
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message }),
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                // --- NEW DEBUGGING STEP ---
                // This will print the exact data received from the backend into the browser's console.
                console.log("Data received from backend:", data);
                // --- END OF DEBUGGING STEP ---

                appendMessage('INGRES Bot', data, 'bot');

            } catch (error) {
                console.error('Error fetching chat response:', error);
                appendMessage('INGRES Bot', { response: 'Sorry, I am having trouble connecting to the server.' }, 'bot');
            } finally {
                typingIndicator.classList.add('hidden');
                scrollToBottom();
            }
        }

        function formatDataAsHTML(data) {
            // More robust checking
            if (!data || !Array.isArray(data) || data.length === 0 || typeof data[0] !== 'object') {
                return '';
            }

            const headers = Object.keys(data[0]);
            if (headers.length === 0) return '';

            let table = '<div class="mt-2 overflow-x-auto rounded-md border bg-white"><table class="min-w-full divide-y divide-gray-300 data-table">';
            table += '<thead class="bg-gray-50"><tr>';
            headers.forEach(header => {
                table += `<th scope="col" class="font-medium text-gray-600 uppercase tracking-wider">${header.replace(/_/g, ' ')}</th>`;
            });
            table += '</tr></thead>';
            table += '<tbody class="divide-y divide-gray-200">';
            data.forEach(row => {
                table += '<tr>';
                headers.forEach(header => {
                    table += `<td class="whitespace-nowrap text-gray-800">${row[header] || 'N/A'}</td>`;
                });
                table += '</tr>';
            });
            table += '</tbody></table></div>';
            return table;
        }

        function appendMessage(sender, content, type) {
            const messageDiv = document.createElement('div');
            const bubbleClass = type === 'user' ? 'chat-bubble-user' : 'chat-bubble-bot';
            const justification = type === 'user' ? 'justify-end' : 'justify-start';
            const maxWidth = type === 'user' ? 'max-w-lg' : 'max-w-2xl';
            
            let messageHTML = '';
            // Handle different content types more safely
            if (type === 'user') {
                messageHTML = `<p>${content}</p>`;
            } else if (content && typeof content === 'object') {
                messageHTML = `<p>${content.response || ''}</p>`;
                if (content.data) {
                    messageHTML += formatDataAsHTML(content.data);
                }
            } else {
                 messageHTML = `<p>An unexpected response was received.</p>`;
            }

            messageDiv.className = `flex ${justification} mb-4`;
            messageDiv.innerHTML = `
                <div class="${bubbleClass} py-2 px-4 rounded-lg ${maxWidth}">
                    <p class="font-bold mb-1">${sender}</p>
                    <div class="text-sm">${messageHTML}</div>
                </div>
            `;
            chatbox.appendChild(messageDiv);
        }
    </script>
</body>
</html>

